"use strict";(()=>{var e={};e.id=965,e.ids=[965],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1901:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>w,routeModule:()=>m,serverHooks:()=>I,staticGenerationAsyncStorage:()=>f});var r={};s.r(r),s.d(r,{GET:()=>l,POST:()=>y});var n=s(9303),a=s(8716),i=s(670),o=s(9487),d=s(7070),g=s(1185),u=s(3591),p=s(4063),c=s(4479);let l=async e=>{try{let{searchParams:t}=new URL(e.url),s=t.get("userId"),r=t.get("categoryId"),n=t.get("keywords"),a=t.get("startDate"),i=t.get("endDate"),l=parseInt(t.get("page")||"1"),y=parseInt(t.get("limit")||"10");if(!s||!g.Types.ObjectId.isValid(s))return new d.NextResponse(JSON.stringify({message:"Invalid or missing userId"}),{status:400});if(!r||!g.Types.ObjectId.isValid(r))return new d.NextResponse(JSON.stringify({message:"Invalid or missing categoryId"}),{status:400});if(await (0,o.Z)(),!await u.Z.findById(s))return new d.NextResponse(JSON.stringify({message:"User not found"}),{status:404});if(await p.Z.findById(r),!r)return new d.NextResponse(JSON.stringify({message:"Category not found"}),{status:404});let m={user:new g.Types.ObjectId(s),category:new g.Types.ObjectId(r)};n&&(m.$or=[{title:{$regex:n,$options:"i"}},{description:{$regex:n,$options:"i"}}]),a&&i?m.createdAt={$gte:new Date(a),$lte:new Date(i)}:a?m.createdAt={$gte:new Date(a)}:i&&(m.createdAt={$lte:new Date(i)});let w=await c.Z.find(m).sort({createdAt:"asc"}).skip((l-1)*y).limit(y);return new d.NextResponse(JSON.stringify({blogs:w}),{status:200})}catch(e){return new d.NextResponse("Error in fetching blogs "+e.message,{status:500})}},y=async e=>{try{let{searchParams:t}=new URL(e.url),s=t.get("userId"),r=t.get("categoryId"),{title:n,description:a}=await e.json();if(!s||!g.Types.ObjectId.isValid(s))return new d.NextResponse(JSON.stringify({message:"Invalid or missing userId"}),{status:400});if(!r||!g.Types.ObjectId.isValid(s))return new d.NextResponse(JSON.stringify({message:"Invalid or missing categoryId"}),{status:400});if(await (0,o.Z)(),!await u.Z.findById(s))return new d.NextResponse(JSON.stringify({message:"User not found"}),{status:404});if(!await p.Z.findById(r))return new d.NextResponse(JSON.stringify({message:"Category not found"}),{status:404});let i=new c.Z({title:n,description:a,user:new g.Types.ObjectId(s),category:new g.Types.ObjectId(r)});return await i.save(),new d.NextResponse(JSON.stringify({message:"Blog is created",blog:i}),{status:200})}catch(e){return new d.NextResponse("Error in the fetching blog "+e.message,{status:500})}},m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/(dashboard)/blogs/route",pathname:"/api/blogs",filename:"route",bundlePath:"app/api/(dashboard)/blogs/route"},resolvedPagePath:"E:\\rest-api-next.js\\app\\api\\(dashboard)\\blogs\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:I}=m,b="/api/(dashboard)/blogs/route";function h(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:f})}},9487:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(1185),n=s.n(r);let a=process.env.MONGODB_URI,i=async()=>{let e=n().connection.readyState;if(1===e){console.log("Already connected");return}if(2===e){console.log("Connecting...");return}try{n().connect(a,{dbName:"REST_APIs_with_Nextjs",bufferCommands:!0}),console.log("Connected")}catch(e){throw console.log("Error: ",e),Error("Error: ",e)}}},4479:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(1185);let n=new r.Schema({title:{type:"string",required:!0},description:{type:"string"},user:{type:r.Schema.Types.ObjectId,ref:"User"},category:{type:r.Schema.Types.ObjectId,ref:"Category"}},{timestamps:!0}),a=r.models.Blog||(0,r.model)("Blog",n)},4063:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(1185);let n=new r.Schema({title:{type:"string",required:!0},user:{type:r.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0}),a=r.models.Category||(0,r.model)("Category",n)},3591:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(1185);let n=new r.Schema({email:{type:"string",required:!0,unique:!0},username:{type:"string",required:!0,unique:!0},password:{type:"string",required:!0}},{timestamps:!0}),a=r.models.User||(0,r.model)("User",n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972],()=>s(1901));module.exports=r})();